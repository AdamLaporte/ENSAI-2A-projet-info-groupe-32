@startuml

/' 
-------------------------------------------------------------------
  NOTICE D’UTILISATION DANS VSCODE 

  1. Installer Java et Graphviz dans ton environnement :
     - Ouvre un terminal puis tape :
         sudo apt update
         sudo apt install -y default-jre graphviz

  2. Dans VSCode :
     - Installer l’extension "PlantUML"

  3. Exécution :
     - Ouvrir ce fichier .puml dans VSCode
     - Appuyer sur ALT + D pour générer et prévisualiser le diagramme
------------------------------------------------------------------- 
'/

actor Utilisateur

Utilisateur -> StatistiqueService : afficher(id_qrcode, token)

StatistiqueService -> TokenService : verifier_token(token)
TokenService -> TokenDao : Trouver_token_par_valeur(token)
TokenDao --> TokenService : Token | null
TokenService --> StatistiqueService : bool

alt Token valide
    StatistiqueService -> TokenService : Trouver_id_user_par_tocken(token)
    TokenService -> TokenDao : Trouver_id_user_par_tocken(token)
    TokenDao --> TokenService : id_user
    TokenService --> StatistiqueService : id_user

    StatistiqueService -> QrcodeDao : trouver_par_id(id_qrcode)
    QrcodeDao --> StatistiqueService : Qrcode

    StatistiqueService -> QrcodeService : verifier_proprietaire(id_qrcode, id_user:int)
    QrcodeService --> StatistiqueService : bool

    alt Qrcode appartient à l’utilisateur
        StatistiqueService -> StatistiqueDao : afficher(id_qrcode:int)
        StatistiqueDao --> StatistiqueService : List<Statistique>
        StatistiqueService --> Utilisateur : Statistiques du Qrcode
    else Qrcode n’appartient pas à l’utilisateur
        StatistiqueService --> Utilisateur : Erreur (Accès interdit)
    end
else Token invalide
    StatistiqueService --> Utilisateur : Erreur (Token invalide ou expiré)
end

@enduml
